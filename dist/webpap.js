document.addEventListener("DOMContentLoaded",async()=>{const e=sessionStorage.getItem("formData"),t=e?JSON.parse(e):null;t?await S(t).then(()=>{sessionStorage.clear()}):console.log("No form data found in sessionStorage.")});let r=0,n="";const d="https://www.medserviceswebpap.com/api/patient/createpatient",c="https://www.medserviceswebpap.com/api/physician/createphysician",h="https://www.medserviceswebpap.com/auth/token?hcpid=89",l={grant_type:"password",username:"apiuser",password:"123456"};async function y(e,t){const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t).toString()});if(!o.ok)throw new Error(o.statusText);return o.json()}async function p(e,t){try{const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok");const a=await o.json();t.id=a.Id,console.log(t)}catch(o){console.log(o)}}async function u(e,t){try{const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok");const a=await o.json();r=a.Id,console.log(a)}catch(o){console.log(o)}}async function m(e,t){try{if(!(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)})).ok)throw new Error("Network response was not ok")}catch(o){console.log(o)}}async function g(e,t){let o;t==="private"?o={privateins:"true"}:o={none:"true"};try{if(!(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(o)})).ok)throw new Error("Network response was not ok")}catch(a){console.log(a)}}async function f(e){try{const t=await fetch(e,{method:"get",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!t.ok)throw new Error("Network response was not ok");let o=await t.json();return console.log(o),o}catch(t){console.log(t)}}async function k(e){try{const t=await fetch("https://www.medserviceswebpap.com/api/paporders/additem",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(e)});if(!t.ok)throw new Error("Network response was not ok");let o=await t.json();return console.log(o),o}catch(t){console.log(t)}}async function S(e){const t=document.querySelector(".loader-s");return t.style.display="flex",new Promise(async(o,a)=>{try{await y(h,l).then(s=>{n=s.access_token}).then(async()=>{await u(d,e.patientData);let s=`https://www.medserviceswebpap.com/api/patient/updatepatientincome?patientId=${r}`;await m(s,e.patientIncomeData),e.drugData.CustomerId=`${r}`;let w=`https://www.medserviceswebpap.com/api/patient/updatepatientinsurance?patientId=${r}`;await g(w,e.insurance),await p(c,e.doctorData),e.doctor2Data.fname!==""&&await p(c,e.doctor2Data),await Promise.all(e.drugData.OrderItems.map(async i=>{await f(`https://www.medserviceswebpap.com/api/physician/getphysician?fname=${e.doctorData.fname}&lname=${e.doctorData.lname}`),i.physicianid.includes(e.doctorData.fname)&&i.physicianid.includes(e.doctorData.lname)&&(i.physicianid=e.doctorData.id)})),await k(e.drugData)}),t.classList.add("hide"),setTimeout(()=>{t.style.display="none"},200),o()}catch(s){a(s)}})}
